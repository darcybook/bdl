---
title: "4.变量"
weight: 4
date: 2023-07-18T09:23:44+08:00
lastmod: 2023-07-18T09:23:44+08:00
tags: ["variable"]
categories: ["variable"]
# bookComments: false
# bookSearchExclude: false
---

# 变量

## 变量定义

变量定义，变量申明，都是同一个意思的两种翻译方法。

在定义变量的时候，需要给这个变量-一个名字。有了名字之后才能使用这个变量。回顾曾经编写的BDL语言代码，可以发现这些代码中，凡是用双引号括起来的部分，都是字符串。
那些没有用引号括起来的单词，一部分是C语言提供的关键字，比如integer，string等， 还有一部分是BDL语言提供的符号，如=、+、-、()、{}等，这些单词和符号就是BDL语言的核心部分，编译器生来就认识它们。
另外没有使用双引号括起来的单词，如define a integer,其中的integer是关键字，a就是非BDL语言的`关键字`，对于编译器来说，它是不认识的。
要让编译器知道这个单词是什么意思，所以有了定义(define)。

对于变量来说，变量的定义会使得编译器在变量符号表中新增一条记录。
这样编译器在后面如果读入了一个变量名，通过查询符号表，就知道是否声明过了。

+ 一行可以定义多个变量

```sql
define a,b,c integer
```

+ 一样也可以拆成两行
```sql
define a,
       b,
       c integer
```
+ 每行也可以只定义一个变量
```sql
define a integer
define b integer
define c integer
```
+ 变量定义的顺序可以打乱

```sql
define b integer
define a integer
define c integer
```

+ 不同类型可以定义在同一个define中，但必须指定每个不同类型变量的数据类型
```sql
define a,
       b integer
       c varchar(10)
```

## 定义变量的意义

BDL为什么要规定要先定义变量呢？
为什么要指定变量的名字和对应的数据类型呢？

1. 建立变量符号表

通过声明变量，编译器可以建立变量符号表，如此一来，程序中用到了多少变量，每个变量的类型是什么，编译器非常清楚。如果使用了没有声明的变量，编译器在编译期间就可以发现，从而帮助程序员远离由于疏忽而将变量名写错的情况。下面演示了写错变量名后编译器编译时的提示信息。

```sql
define a integer
let a = 1
let b = a * 10
display b
```

编译提示变量未定义
```shell
czzi001  ..............
../42m/czz_czzi001.4gl:5:5:5:5:error:(-4369) The symbol 'b' does not represent a defined variable.
../42m/czz_czzi001.4gl:6:9:6:9:error:(-4369) The symbol 'b' does not represent a defined variable.
The compilation was not successful.  Errors found: 2.
 The file '../42m/czz_czzi001.err' has been written.
```

2. 变量的数据类型指示系统分配多少内存空间

变量需要存储空间来存储。不同的数据类型占据不同的空间大小。在声明变量时需要指定变量的数据类型，因而可以准确地为变量分配确定大小的内存空间。
比如integer x,则分配4个字节的空间: float y，则y占用了8个字节的空间。

3. 变量

变量的数据类型指示了系统如何解释存储空间中的值。
读者已经明白，同样的数值，不同的类型将有不同的解释。
integer占 据4个字节，float也占据4个字节，在内存中同样也是存储的二进制数，并且这个二进制数也没有标志区分当前是integer型
还是float型。
如何区分?就是通过变量的数据类型来区分。
由于声明建立了变量符号表，所以系统知道变量该如何解释。

4. 变量的数据类型确定了改变了的取值范围

5. 不同的数据类型有不同的操作

例如：整数可以做除法，但字符串就不可以，编译时就报错

## 标识符和关键字

在定义变量时，要高速编译器变量的名字。

这个名字被称作标识符，简单地说，标识符就是一个名字，一个在某范围内唯一的名字， 通过这个名字，就能找到一个唯一与之对应的对象。
变量名，通过名字可以找到变量的值;符号常量名，通过名称可以找到符号常量代表的实际值:函数名，通过名字可以调用函数;数组名、类型名、文件名等都是一个标识符。
在很多时候，将标识符简称为ID,就是identifier的前两个字符的缩写。
标识符必须在某个范围内是唯一的，所谓某个范围内，在以后的章节会继续讲述。
正如在中国，身份证是一个人的ID，在全中国唯一，通过身份证ID就能找到一个具体对应的人。


BDL语言规定，标识符只能由字母(26个小写字母和26个大写字母)、数字(0~ 9共10个数字)和下划线(_)3种字符组成。
并且标识符的第一个字符不能是数字，也就是只能是字母或者下划线。
BDL语言规定，标识符不区分大写字母和小写字母，即大写定义的标识符小写也可调用，反之亦然。

合法标识符：
```
sum,yes,no,success,student
```
不合法标识符：
```
1year,#year,M.D,m-d
```
BDL语言中的关键字保留不能用作标识符。

### 变量标识符规则

+ 变量名一般小写
+ 不同作用域以不同开头命名
    - 在main函数之外定义的参数，一般以`g_`开头（global），例如`g_index`,`g_age`
    - 在mian函数中，或者其它function函数中，以`l_`开头（local），例如：`l_count`
    - 在function函数中定义的参数，一般以`p_`开头(parament),例如：`p_name`
+ 对于多个词构成的标识符号，有多种可选写法，没有规则，但应该保持一致

    - 驼峰 g_printEmployeePaychecks
    - 下划线 g_print_employee_paychecks
    - 帕斯卡 g_PrintEmployeePaychecks

## 变量在内存中占据的空间和变量的值

变量在内存中要占据-定的内存空间。
不同的变量类型，其空间大小占用也不同。前面章节已经说了很多次了。
现在的计算机，一般可以访问从0~ 64GB空间大小的内存，这64GB的内存空间，如何划分不同的区域，是非常有讲究的。

计算机也一样，管理这么大的内存，也要分段管理。
就是说，从内存某地址开始到某地址结束，是操作系统使用的内存区域，普通程序想要使用那是难上加难。
在普通程序使用的内存区域里，又有很多类型的内存区域。
一般可以认为被分成了堆、栈、全局/静态存储区和常量存储区几个区域。
这些区域有各自的特点。
常量当然是放在了常量存储区里，所以保证了数据不被修改。
变量放在其他的几个区域。

所谓“栈”，就是那些在需要的时候由系统分配，在不需要的时候自动清除的变量存储区。
里面的变量通常是局部变量、函数参数等。
注意是编译器在编译的时候分配的。在“栈”中分配内存，其内存大小在编译的时候就知道。

所谓“堆”，就是那些由程序员调用系统内存分配函数分配的内存块。
编译器并不知道需要分配多大的内存，在程序运行的时候，根据需要来动态分配。这些分配的内存，完全由程序员管理，编译器不会释放。

```sql
function foo()
    define x integer
    let x=3
    display x
end function
```

这是一个函数定义。
当该函数被调用时，系统根据函数的定义，将x在内存分配了一块4字节的内存。
x的生存周期时foo函数的生存周，当end fucntion结束后，函数就结束了。
这个时候，x在内存分配的预对于x来说已经无效了，x就不存在了，与x关联的内存空间可以被其它变量关联了。

{{< hint info >}}
如果对以上叙述不理解的话，可暂时不用深究，有这个映像就可以了。
{{< /hint >}}

读者要分清楚变量名和变量的值。let x=3 此时x是变量名，3是常量，通过赋值符“=”,使得变量x的值变为了3。
在BDL语言中，直接通过变量名，可以访问到变量的值。
display x 通过变量x， 得到了变量x的值了。

## 变量赋初值

在程序设计中，经常要对一写变量预先设置初值。
所谓初值，就是分配内存后填入的第一个值。

BDL语言中每个类型的初始值不同：

+ integer 默认初始值为 0 
+ float/decimal/string/varchar/char 初始值为null
