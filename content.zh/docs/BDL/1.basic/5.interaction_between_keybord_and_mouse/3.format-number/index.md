---
title: "3.数字的格式化"
weight: 3
date: 2023-07-18T13:24:57+08:00
lastmod: 2023-07-18T13:24:57+08:00
tags: ["format","number"]
categories: ["format","number"]
# bookComments: false
# bookSearchExclude: false
---

# 数字的格式化

之前我们说过日期在BDL语言也是储存为整数类型，请运行以下代码，观察其输出值

```sql
define t date
display t
```
发现其结果是
```sql
1899/12/31
```
>如果你的环境是`1899/12/31`，是因为`DBDATE`环境变量为`Y2MD/`，修改为`Y4MD/`之后就变为4位。不建议修改，因为已有代码可能是按照2位编写的。

日期类型会自动格式输出，那么我如果也想数字格式化输出字符串，应该如果写呢？

本章就来介绍以下，数字的格式化方式。


## 数字货币格式化

在介绍之前，我们尝试运行一下如下代码：

```sql
    define a integer
    define b decimal(20,6)

    let a = 12345
    let b = 2345.1235
    display sfmt("a=%1,b=%2",a,b)
    display sfmt("a=%1,b=%2",a using "******",b using "#####.###")
```
```sh
a=12345,b=2345.123500
a=*12345,b= 2345.124
```
+ 使用了 using "******" 的12345 在最前面多了一个`*`
+ 使用了 using "#####.###" 的2345.1235，整数前多了一个空格，小数保留了3位，且进了一位。

这里的`数字/数字变量 using 格式化字符串`的格式就是在格式化数字格式。

格式化字符串中有固定的写法，如下：

类型|格式化规则
:---|:-------
*|不足的位数补上`*`
#|不足的位数补上空格
&|不足的位数补上0
`<`|和`&`一样，但是左对齐
`-`|和`#`一样，但负数会加上-号
`+`|和`-`一样，但整数会加上+号
`(`|和`-`一样，但负数会加上()号
`)`|和`(`一样
`$`|数值前加上一个币种符号
,|,号左侧有数字才显示,
.|可以限制小数位数
@|显示多为币种符号

虽然开起来很复杂，但实际使用场景就只有几种
+ 金额保留位数
+ 数字左对齐或者右对齐
+ 小数不足位数

常用的几种格式示例:

```sql
 --数量左对齐
 a using "<<<,<<<,<<+.&&&" --整数部分最大9位，小数保留3位，小数不足补0，正数负数都要有+/-号
 -- 金额右对齐
 a using "###,###,##-.&&" --整数部分最大9位，小数保留2位，小数不足补0，负数显示-号
```

## 日期格式化 

章节开头我们说过日期格式化是`1899/12/31`格式，是环境变量设置。
但如果我们一个程序中需要两种不同格式的日期格式该如果处理呢？

其实`date`类型也能用`using`关键字格式化，格式化规则如下

类型|格式化规则
:---|:-------
dd|两位表示日期，只有一位时会补0
ddd|表示因为英文星期
mm|同日期，两位月份，自动补0
mmm|三位英文月份
yy|两位月份
yyyy|四位年份
c1|在dd或者ddd后加上c1，可以使用从1912年开始计算年份（民国）

在年月日中，你可以加上合适的分隔符，时日期更好读。
```sql
display a using "yyyy年mm月dd日"
```

### 日期格式的运算

在定义日期时，我们知道日期是一个整型，所以如果第二天直接`+1`即可。

但是我们在进行赋值一个日期时，还要计算要赋值日期和`1899/12/31`之前差多少天，也太不方便了。

所以日期格式有一些更方便的计算和赋值函数(关键字)。

名称|使用方法
:----:|:------
today()|值为今天的日期`let a = today()`
current|当前的时间`let a= current`,注意没有(),所以它是关键字。
date()<sub>1</sub>|`let a = date(34000)``1899/12/31`后的第34000天
date()<sub>2</sub>|`let a = date("1949/10/01")` 以字符串格式赋值日期，字符串的格式必须与`DBDATE`格式一致
mdy()|`let a = mdy(10,01,1949)`以整型赋值日期，注意参数顺序
year()|`let a= year(current)`取一个日期的年份
month()|`let a= month(current)`取一个日期的月份
day()|`let a= day(current)`取一个日期的日
weekday()|`let a = weekday(current)`取日期的星期
extend(a,b to c)|`extend (today,year to fraction(4))`将日期调整为`year to fraction`格式


